---
title:  Spring Async
createTime: 2023/08/01 11:00:00
permalink: /java/spring/spring-async/
article: true
#sidebar: false
---

# Spring Async概要

## Spring Asyncとは

Spring Asyncは、Springフレームワークが提供する非同期処理機能です。`@Async`アノテーションを使用することで、メソッドを非同期的に実行することができます。これにより、長時間実行される処理をバックグラウンドで実行し、アプリケーションの応答性を向上させることができます。

## 主な機能

### @Asyncアノテーション

`@Async`アノテーションを使用することで、メソッドを非同期的に実行することができます。

```java
@Service
public class EmailService {
    @Async
    public void sendEmail(String to, String subject, String content) {
        // メール送信処理（時間がかかる処理）
    }
}
```

### 戻り値の処理

非同期メソッドは、`void`または`Future`型（`CompletableFuture`、`ListenableFuture`など）を返すことができます。

```java
@Service
public class DataProcessingService {
    @Async
    public CompletableFuture<List<Data>> processData(List<Data> rawData) {
        // データ処理（時間がかかる処理）
        return CompletableFuture.completedFuture(processedData);
    }
}
```

### 設定

Spring Asyncを使用するには、`@EnableAsync`アノテーションを設定クラスに追加し、非同期処理用のExecutorを設定する必要があります。

```java
@Configuration
@EnableAsync
public class AsyncConfig implements AsyncConfigurer {
    @Override
    public Executor getAsyncExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(5);
        executor.setMaxPoolSize(10);
        executor.setQueueCapacity(25);
        executor.setThreadNamePrefix("Async-");
        executor.initialize();
        return executor;
    }
    
    @Override
    public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
        return new SimpleAsyncUncaughtExceptionHandler();
    }
}
```

## メリット

- 応答性の向上：時間のかかる処理を非同期的に実行することで、アプリケーションの応答性が向上します
- スケーラビリティ：非同期処理により、システムリソースをより効率的に使用することができます
- 簡単な実装：`@Async`アノテーションを使用するだけで、簡単に非同期処理を実装できます

## 注意点

- 同一クラス内での呼び出し：同じクラス内のメソッドから`@Async`メソッドを呼び出した場合、非同期処理は行われません
- 例外処理：非同期メソッドで発生した例外は、呼び出し元に伝播されないため、適切な例外処理が必要です
- トランザクション：非同期メソッドは新しいトランザクションで実行されるため、トランザクション管理に注意が必要です

## Reference

- [Spring Asynchronous Methods](https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#scheduling-annotation-support)