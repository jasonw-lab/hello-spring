---
title:  Spring Condition
createTime: 2023/08/01 11:30:00
permalink: /java/spring/spring-condition/
article: true
#sidebar: false
---

# Spring Condition概要

## Spring Conditionとは

Spring Conditionは、Springフレームワークが提供する条件付きBeanの登録機能です。`@Conditional`アノテーションとその派生アノテーションを使用することで、特定の条件が満たされた場合にのみBeanを登録することができます。これにより、アプリケーションの設定を環境やプロパティに応じて動的に変更することができます。

## 主な機能

### @Conditionalアノテーション

`@Conditional`アノテーションは、指定された条件が`true`を返す場合にのみ、Beanを登録します。

```java
@Configuration
public class AppConfig {
    @Bean
    @Conditional(CustomCondition.class)
    public MyService myService() {
        return new MyServiceImpl();
    }
}

public class CustomCondition implements Condition {
    @Override
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        // 条件のロジック
        return true; // または false
    }
}
```

### 組み込み条件アノテーション

Spring Bootは、よく使用される条件のための組み込みアノテーションを提供しています：

- **@ConditionalOnBean**：指定されたBeanが存在する場合
- **@ConditionalOnMissingBean**：指定されたBeanが存在しない場合
- **@ConditionalOnClass**：指定されたクラスがクラスパスに存在する場合
- **@ConditionalOnMissingClass**：指定されたクラスがクラスパスに存在しない場合
- **@ConditionalOnProperty**：指定されたプロパティが特定の値を持つ場合
- **@ConditionalOnResource**：指定されたリソースが存在する場合
- **@ConditionalOnWebApplication**：Webアプリケーションの場合
- **@ConditionalOnNotWebApplication**：Webアプリケーションでない場合

```java
@Configuration
public class AppConfig {
    @Bean
    @ConditionalOnProperty(name = "app.feature.enabled", havingValue = "true")
    public FeatureService featureService() {
        return new FeatureServiceImpl();
    }
    
    @Bean
    @ConditionalOnMissingBean(FeatureService.class)
    public FeatureService defaultFeatureService() {
        return new DefaultFeatureServiceImpl();
    }
}
```

### プロファイル条件

`@Profile`アノテーションを使用することで、特定のプロファイルがアクティブな場合にのみBeanを登録することができます。

```java
@Configuration
public class AppConfig {
    @Bean
    @Profile("development")
    public DataSource developmentDataSource() {
        // 開発環境用のデータソース
    }
    
    @Bean
    @Profile("production")
    public DataSource productionDataSource() {
        // 本番環境用のデータソース
    }
}
```

## メリット

- 柔軟な設定：環境やプロパティに応じて、異なるBeanを登録することができます
- コードの再利用：条件付きBeanを使用することで、環境ごとに異なるコードを書く必要がなくなります
- 自動設定：Spring Bootの自動設定は、条件付きBeanを使用して実装されています

## Reference

- [Spring Conditional Annotations](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-java-conditional)
- [Spring Boot Conditional Annotations](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.developing-auto-configuration.condition-annotations)