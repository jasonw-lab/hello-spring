---
title:  Spring Event
createTime: 2023/08/01 12:00:00
permalink: /java/spring/spring-event/
article: true
#sidebar: false
---

# Spring Event概要

## Spring Eventとは

Spring Eventは、Springフレームワークが提供するイベント処理機能です。アプリケーション内のコンポーネント間で疎結合な通信を実現するために使用されます。イベントを発行（publish）すると、そのイベントをリッスンしているコンポーネントが処理を行うことができます。

## 主な機能

### イベントの作成

Spring Eventは、`ApplicationEvent`クラスを継承するか、任意のPOJOをイベントとして使用することができます。

```java
// ApplicationEventを継承する場合
public class UserCreatedEvent extends ApplicationEvent {
    private final User user;
    
    public UserCreatedEvent(Object source, User user) {
        super(source);
        this.user = user;
    }
    
    public User getUser() {
        return user;
    }
}

// POJOをイベントとして使用する場合
public class UserCreatedEvent {
    private final User user;
    
    public UserCreatedEvent(User user) {
        this.user = user;
    }
    
    public User getUser() {
        return user;
    }
}
```

### イベントの発行

イベントを発行するには、`ApplicationEventPublisher`を使用します。

```java
@Service
public class UserService {
    @Autowired
    private ApplicationEventPublisher eventPublisher;
    
    public void createUser(User user) {
        // ユーザー作成のロジック
        
        // イベントの発行
        eventPublisher.publishEvent(new UserCreatedEvent(this, user));
        // または、POJOの場合
        // eventPublisher.publishEvent(new UserCreatedEvent(user));
    }
}
```

### イベントリスナーの作成

イベントをリッスンするには、`@EventListener`アノテーションを使用します。

```java
@Component
public class UserEventListener {
    @EventListener
    public void handleUserCreatedEvent(UserCreatedEvent event) {
        User user = event.getUser();
        // イベント処理のロジック
    }
}
```

### 非同期イベント処理

`@Async`アノテーションと組み合わせることで、イベントを非同期で処理することができます。

```java
@Component
public class UserEventListener {
    @Async
    @EventListener
    public void handleUserCreatedEvent(UserCreatedEvent event) {
        // 非同期でイベントを処理
    }
}
```

### トランザクショナルイベント

`@TransactionalEventListener`アノテーションを使用することで、トランザクションの特定のフェーズでイベントを処理することができます。

```java
@Component
public class UserEventListener {
    @TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
    public void handleUserCreatedEvent(UserCreatedEvent event) {
        // トランザクションがコミットされた後にイベントを処理
    }
}
```

## メリット

- 疎結合：イベント発行者とリスナーは疎結合であり、直接的な依存関係がありません
- 拡張性：新しい機能を追加する際に、既存のコードを変更せずにイベントリスナーを追加できます
- 柔軟性：同じイベントに対して複数のリスナーを設定できます

## Reference

- [Spring Events](https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#context-functionality-events)